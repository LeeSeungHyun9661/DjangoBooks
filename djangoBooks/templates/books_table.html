{% load static %}
<div id="table">
  <div class="container">
    <ul class="list-group">
      {% if books_list %}
        {% for book in books_list %}
          <li class="list-group-item clearfix ">
            {% if book.img_url %}
              <img class="img-responsive img-book" src="{{book.img_url}}" alt=""/>
            {% else %}
              <img class="img-responsive img-book" src="{% static 'img/no_book_image.png' %}" alt=""/>
            {% endif %}
            <h3 class="list-group-item-heading">
              {{book.title}}
            </h3>
            <p class="list-group-item-text lead">
              {{book.author}}
              <br/>
            </p>
            <div class="btn-toolbar pull-right" role="toolbar" aria-label="">
              <a href="#" class="btn btn-default m-1">Add to Bookshelf</a>
              <a href="#" class="btn btn-primary m-1" data-bs-toggle="modal" data-bs-target="#staticBackdrop" data-url="{% url 'djangoBooks:detail'%}?isbn13={{book.isbn13}}">More</a>
            </div>
          </li>
        {% endfor %}

        <!-- START Pagination -->
        <div class="text-center mt-3 mt-sm-3">
          <ul class="pagination justify-content-center mb-3">
            {% if books_list.has_previous %}
              <li class="page-item">
              {% else %}
                <li class="page-item disabled">
                {% endif %}
                <a class="page-link" href="#">First</a>
              </li>
              {% for page in books_list.paginator.page_range %}
                {% if page >= books_list.number|add:-2 and page <= books_list.number|add:2 %}
                  {% if page == books_list.number%}
                    <li class="page-item d-none d-md-inline-block">
                      <a class="page-link active" href="#">{{page}}</a>
                    </li>
                    {%else%}
                    <li class="page-item">
                      <a class="page-link" href="#">{{page}}</a>
                    </li>
                  {% endif %}
                {% endif %}
              {%endfor %}
              {% if books_list.has_next %}
                <li class="page-item" value="{{books_list.paginator.num_pages}}">
                {% else %}
                  <li class="page-item disabled">
                  {% endif %}
                  <a class="page-link" href="#">Last</a>
                </li>
              </ul>
            </div>
            <!-- END Pagination -->
          {% else %}
            <div class="row">
              <div class="col-12">
                <div class="no-result">
                  <p>
                    <b>{{search_input}}</b>도서가 없습니다</p>
                </div>
              </div>
            </div>
          {% endif %}
      </ul>
    </div>
  </div>
  

  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog ">
      <div class="modal-content"></div>
    </div>
  </div>

  <!-- Ajax 기능 구현 -->
<script>
  $(document).on("click", ".btn-primary", function (e) {
    e.preventDefault();
    var url = $(this).data("url");
    var $staticBackdrop = $("#staticBackdrop");
    $(".modal-content", $staticBackdrop).load(url, function () {
      $popup.modal("show");
    });
  });

  //페이지네이션 버튼 클릭에 따른 결과 전달 
  $(".page-item").click(function () {
    if ($(this).text().trim() == 'First') {
    //첫 페이지인 경우 : 1 num_pages = 1; 
    } else if ($(this).text().trim() == 'Last') {
      //마지막 페이지인 경우 : 페이지 끝번 
      num_pages = parseInt($(this).attr("value")); 
    } else { 
      //해당 페이지 : 페이지 번호 
      num_pages = parseInt($(this).text()); 
    } page_click(); 
  }); //페이지 클릭 시 작동방식 : AJAX 

  function page_click() {
    $.ajax({ type: "get", //GET 방식 사용 
    url: "{% url 'djangoBooks:list' %}",
    //djangoBooks의 list url을 불러옴
    data: {
    page: num_pages, //GET 방식에 페이지 번호를 넣어서 전송
    },
    success: function (data) {
      $("#table").html(data);
      //전송 성공시에 전송받는 데이터를 table class에 변경을 추가
      window.scrollTo(0, 0);
      // 스크롤을 위로 다시 올려준다.
    }
  });}
</script>
